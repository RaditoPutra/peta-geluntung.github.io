// 1. Definisi Sistem Koordinat Terproyeksi (EPSG:3857) untuk data meter Anda.
const crs = new L.Proj.CRS('EPSG:3857',
    '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs',
    {
        resolutions: Array.from({ length: 20 }, (v, i) => 156543.03392804097 / (2 ** i))
    });

// 2. Inisialisasi Peta MENGGUNAKAN Sistem Koordinat yang baru.
const mymap = L.map('mapid', {
    crs: crs
});

// 3. Tambahkan dasar peta dari OpenStreetMap.
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(mymap);

// 4. Data poligon Anda (koordinat meter).
const koordinatPolygonPerumahan = [
    // Biarkan array koordinat Anda yang panjang di sini, tidak perlu diubah.
    [12819723.021884352, -944309.5283018965], [12819782.756838517, -944335.3229411951],
    [12819752.889361434, -944399.8095394416], [12819791.581320383, -944422.2101472535],
    [12819820.09118487, -944361.1175804937], [12819980.28947104, -944427.6405976322],
    [12819987.077534014, -944395.0578953603], [12819983.683502527, -944348.8990671417],
    [12819975.537826959, -944272.8727618407], [12820050.400464324, -944273.7778369038],
    [12820051.693428699, -944291.879338166], [12820187.454688165, -944293.8187847298],
    [12820190.687099105, -944310.6273216162], [12820234.647887886, -944309.3343572402],
    [12820239.1732632, -944267.3130150245], [12820276.6692301, -944222.059261869],
    [12820290.891838236, -944212.36202905], [12820348.751994058, -944205.8972071705],
    [12820375.581004858, -944198.4626620093], [12820396.268434871, -944181.977366217],
    [12820374.611281576, -944139.6327829072], [12820371.055629542, -944116.6826652355],
    [12820372.025352826, -944070.7824298923], [12820391.096577369, -943935.9908937083],
    [12820408.551596442, -943833.8467080146], [12820416.309382698, -943806.0479739334],
    [12820438.936259275, -943773.0773823487], [12820508.756335571, -943745.9251304554],
    [12820533.322658714, -943722.6517716898], [12820560.474910606, -943648.952802265],
    [12820576.636965303, -943524.8282221815], [12820586.980680315, -943511.8985784228],
    [12820600.880047355, -943505.7569976375], [12820717.57008228, -943507.373203107],
    [12820749.247709488, -943499.6154168521], [12820772.844309349, -943487.0090141873],
    [12820790.94581061, -943470.8469594889], [12820812.279722815, -943414.2797680445],
    [12820825.532607667, -943344.7829328415], [12820815.51213375, -943165.3841256896],
    [12820908.605568813, -943182.192662576], [12821076.367696583, -943147.9291066153],
    [12821110.308011454, -943061.6237345258], [12821115.479868956, -943124.0092656616],
    [12821145.864531787, -943215.4864952544], [12821156.854728982, -943265.5888648195],
    [12821160.248760471, -943339.6110753382], [12821174.956230246, -943429.9569611017],
    [12821189.502079476, -943475.5339553512], [12821204.694410894, -943548.2632014937],
    [12821225.705082, -943611.2952148175], [12821221.502947778, -943765.4812166399],
    [12821222.79591215, -943846.9379723198], [12821229.26073403, -943867.3021612398],
    [12821254.150298266, -943866.9789201458], [12821297.78784595, -943840.1499093465],
    [12821319.121758154, -943811.0582108895], [12821361.14310037, -943652.6700748453],
    [12821505.955110466, -943659.7813789129], [12821423.205390414, -944084.8434174799],
    [12821420.619461661, -944193.452425053], [12821423.205390414, -944228.3624632014],
    [12821397.992585082, -944314.3445941968], [12821348.859938798, -944422.9536017699],
    [12821321.061204717, -944465.6214261736], [12821295.2019172, -944523.8048230876],
    [12821272.575040622, -944547.0781818534], [12821223.442394339, -944672.4957263126],
    [12821198.876071196, -944713.8705863405], [12821160.73362211, -944746.8411779252],
    [12821125.82358396, -944757.1848929322], [12821104.48967176, -944769.4680545032],
    [12821077.014178772, -944795.3273420206], [12821033.861492727, -944874.0365484015],
    [12821012.85082162, -944905.7141756101], [12820986.9915341, -944933.8361507853],
    [12820960.485764397, -944956.139786269], [12820945.939915167, -944978.1201806589],
    [12820923.636279687, -945029.838755694], [12820886.786794974, -945179.1761411069],
    [12820868.685293712, -945222.4904476985], [12820820.199129617, -945280.3506035185],
    [12820684.761111246, -945483.3460105301], [12820642.73976903, -945599.7128043585],
    [12820638.860875903, -945633.329878131], [12820637.567911526, -945710.2612584953],
    [12820625.931232143, -945741.9388857041], [12820563.868942102, -945818.2237838805],
    [12820492.75590143, -945870.588841103], [12820449.44159484, -945893.2157176808],
    [12820358.934088528, -945896.4481286204], [12820313.680335373, -945875.7606986065],
    [12820326.60997913, -945838.2647317062], [12820335.660729762, -945703.7964366158],
    [12820317.5592285, -945654.0173081448], [12820323.37756819, -945586.7831605995],
    [12820294.932351923, -945478.8206352144], [12820294.932351923, -945441.3246683142],
    [12820344.064998206, -945350.8171620033], [12820347.943891333, -945317.5233293246],
    [12820404.187841684, -945139.0942454545], [12820367.33835697, -945112.5884757492],
    [12820319.498675063, -945100.3053141785], [12820312.387370996, -945111.2955113733],
    [12820178.565558095, -945100.3053141785], [12820163.049985584, -945126.1646016958],
    [12820110.038446173, -945114.5279223131], [12820103.573624292, -945122.2857085683],
    [12819957.468649821, -945076.3854732251], [12819969.105329204, -945024.3436570964],
    [12819849.829365531, -945022.0809694384], [12819727.644232007, -945100.9517963665],
    [12819686.915854167, -945133.9223879509], [12819635.84376132, -945201.1565354962],
    [12819522.062896242, -945307.8260965055], [12819448.363926819, -945201.8030176841],
    [12819503.96139498, -945087.3756704197], [12819550.508112513, -945033.7176488211],
    [12819586.711115038, -944960.6651615845], [12819656.531191334, -944877.2689593409],
    [12819668.167870717, -944851.4096718235], [12819662.349531023, -944689.7891248396],
    [12819704.370873239, -944605.0999582201], [12819718.593481373, -944499.076879399],
    [12819721.825892312, -944446.0653399883], [12819710.835695118, -944363.3156199327],
    [12819712.775141682, -944334.2239214756], [12819723.021884352, -944309.5283018965]
];

// Membuat layer poligon dari data di atas.
const polygonLayer = L.polygon(koordinatPolygonPerumahan, {
    color: 'green',
    fillColor: '#0f0',
    fillOpacity: 0.3
}).addTo(mymap).bindPopup('Area Perumahan');

// 5. Secara otomatis zoom peta ke area poligon agar langsung terlihat.
mymap.fitBounds(polygonLayer.getBounds());
