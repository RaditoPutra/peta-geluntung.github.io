// --- PUSAT PETA & TINGKAT ZOOM ---
// PERBAIKAN: Pusat peta dihitung dari rata-rata koordinat poligon yang baru.
const pusatDesaGeluntung = [-8.45413, 115.16835];
const tingkatZoomAwal = 15;

// --- INISIALISASI PETA ---
const mymap = L.map('mapid').setView(pusatDesaGeluntung, tingkatZoomAwal);

// --- TAMBAHKAN TILE LAYER (Dasar Peta dari OpenStreetMap) ---
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(mymap);

// --- TAMBAHKAN MARKER (Penanda Lokasi) ---
// CATATAN: Koordinat marker ini belum diubah. Anda mungkin perlu menyesuaikannya.
const koordinatKantorDesa = [-8.45688550301095, 115.17126125700298];
L.marker(koordinatKantorDesa)
    .addTo(mymap)
    .bindPopup('<b>Kantor Perbekel Desa Geluntung</b><br>Pusat Pemerintahan Desa.')
    .openPopup();

const koordinatSDGeluntung = [-8.458973, 115.170333];
L.marker(koordinatSDGeluntung)
    .addTo(mymap)
    .bindPopup('<b>SDN 1 Geluntung</b><br>Sekolah Dasar Negeri Geluntung.');

// --- MENAMBAHKAN POLYGON (DENGAN KOORDINAT BARU) ---
const koordinatPolygonSawah = [
    [-8.452054765230011, 115.1615312873761],
    [-8.452283965716168, 115.16206789559934],
    [-8.45285696633546, 115.16179959148774],
    [-8.453056008456562, 115.16214716726869],
    [-8.452513166066073, 115.16240327573885],
    [-8.453104261076506, 115.1638423614284],
    [-8.452814745266258, 115.16390333963561],
    [-8.452404597496258, 115.163872850532],
    [-8.45172905904164, 115.16379967668338],
    [-8.451737101173062, 115.16447217919693],
    [-8.45189794376625, 115.16448379409354],
    [-8.451915176897256, 115.16570335823724],
    [-8.452064530667041, 115.16573239547876],
    [-8.452053041917571, 115.16612730196337],
    [-8.451679657373518, 115.1661679541015],
    [-8.451277550537116, 115.16650478610308],
    [-8.451191384731905, 115.16663254996577],
    [-8.451133940851067, 115.16715231658895],
    [-8.451067880377527, 115.16739332569354],
    [-8.450921398417568, 115.16757916403922],
    [-8.45054514057914, 115.16738461452107],
    [-8.450341214421705, 115.1673526735554],
    [-8.449933361783355, 115.1673613847279],
    [-8.44873565119049, 115.16753270445281],
    [-8.447828031094048, 115.167689505557],
    [-8.447581020191812, 115.16775919493664],
    [-8.447288053567855, 115.16796245562725],
    [-8.447046786769313, 115.168589660044],
    [-8.446839986536192, 115.16881034307956],
    [-8.446185118400058, 115.16905425590828],
    [-8.445082180079595, 115.16919944211585],
    [-8.444967290489924, 115.16929236128874],
    [-8.444912717922849, 115.16941722142727],
    [-8.444927079125456, 115.17046546584604],
    [-8.444858145348057, 115.17075003081288],
    [-8.444746127933513, 115.17096200267596],
    [-8.444602515816024, 115.17112461122846],
    [-8.444099872983964, 115.17131625702251],
    [-8.443482339465568, 115.1714353097127],
    [-8.441888236746559, 115.17134529426396],
    [-8.442037594397922, 115.17218156681966],
    [-8.44173313450898, 115.17368859965437],
    [-8.44096623919633, 115.17399349069032],
    [-8.441520586897019, 115.17403995027674],
    [-8.442333437267536, 115.17431290034698],
    [-8.442778637275078, 115.17441162696814],
    [-8.443436383443306, 115.17444211607176],
    [-8.444239176920135, 115.17457423552067],
    [-8.444644163335594, 115.1747049031075],
    [-8.44529041737369, 115.17484137814263],
    [-8.445850503331272, 115.17503012021248],
    [-8.447220556323932, 115.1749923717985],
    [-8.447944355940901, 115.17500398669507],
    [-8.448125305632956, 115.1750620611781],
    [-8.448122433416286, 115.17528564793778],
    [-8.447884039358021, 115.17567765069828],
    [-8.447625539610291, 115.17586929649228],
    [-8.446218149056344, 115.17624678063201],
    [-8.446281338130067, 115.17754764905193],
    [-8.450058302602198, 115.17680429566914],
    [-8.45102336135637, 115.17678106587593],
    [-8.451333558300178, 115.17680429566914],
    [-8.452097560819853, 115.17657780518529],
    [-8.453062614470364, 115.17613643911422],
    [-8.453441742029302, 115.17588671883719],
    [-8.453958733554261, 115.17565442090506],
    [-8.454165529970112, 115.17545116021445],
    [-8.455279930967942, 115.17500979414338],
    [-8.45564756770374, 115.17478911110786],
    [-8.455940527976514, 115.17444647165797],
    [-8.456032437035809, 115.17413286944956],
    [-8.456141579015256, 115.17394122365559],
    [-8.456371351502526, 115.17369440710269],
    [-8.45707072066756, 115.17330675992844],
    [-8.457352191266937, 115.17311801785858],
    [-8.457602068055332, 115.17288571992644],
    [-8.45780024608263, 115.17264761454601],
    [-8.457995551864887, 115.17251694695918],
    [-8.458455094491445, 115.17231658999275],
    [-8.459782020749211, 115.17198556543944],
    [-8.46016688595159, 115.17182295688697],
    [-8.460680996330984, 115.1713873982642],
    [-8.462484685419355, 115.17017073784469],
    [-8.463518643507847, 115.16979325370497],
    [-8.463817341994309, 115.16975840901513],
    [-8.464500901120257, 115.16974679411852],
    [-8.464782366289963, 115.16964226004907],
    [-8.465460179527655, 115.16908474501196],
    [-8.465925457415288, 115.16844592569858],
    [-8.466126503242114, 115.16805682666228],
    [-8.466155224065949, 115.1672437838998],
    [-8.46597141075639, 115.16683726251858],
    [-8.465638248909102, 115.16695341148464],
    [-8.464443459223604, 115.16703471576089],
    [-8.46400115633234, 115.16687210720839],
    [-8.463403759412891, 115.16692437424311],
    [-8.462444475882053, 115.16666884651778],
    [-8.46211131098292, 115.16666884651778],
    [-8.461307118659594, 115.16711021258884],
    [-8.461011290346772, 115.16714505727866],
    [-8.45942587648805, 115.16765030528104],
    [-8.45919036155385, 115.16731928072774],
    [-8.459081220437959, 115.1668895295533],
    [-8.459178873016791, 115.16682564762195],
    [-8.459081220437959, 115.16562350582319],
    [-8.459310991172279, 115.16548412706389],
    [-8.459207594358796, 115.16500791630304],
    [-8.45927652557087, 115.16494984181999],
    [-8.458868682386711, 115.16363735850344],
    [-8.458406268113395, 115.1637418925729],
    [-8.458386163132399, 115.16267041836096],
    [-8.45908696470799, 115.16157281063158],
    [-8.45937992236585, 115.16120694138849],
    [-8.459977325526825, 115.16074815297252],
    [-8.460925126717784, 115.1597260420711],
    [-8.459983069783492, 115.15906399296453],
    [-8.458966335019408, 115.15956343351863],
    [-8.458489560166337, 115.15998156979646],
    [-8.457840456104716, 115.16030678690147],
    [-8.457099442166708, 115.16093399131822],
    [-8.456869670113552, 115.16103852538768],
    [-8.455433591677508, 115.1609862583529],
    [-8.454681084440463, 115.16136374249264],
    [-8.453739012240868, 115.1614915063553],
    [-8.453267975277734, 115.16152054359681],
    [-8.452532696916657, 115.16142181697568],
    [-8.452274200284698, 115.16143923932059]
];

L.polygon(koordinatPolygonSawah, {
    color: 'green',
    fillColor: '#32a852',
    fillOpacity: 0.4
}).addTo(mymap).bindPopup('Area Persawahan');

const legend = L.control({ position: 'topright' });

legend.onAdd = function (map) {
    const div = L.DomUtil.create('div', 'info legend');
    const labels = [
        '<strong>Legenda</strong>'
    ];
    
    // URL untuk ikon marker biru default dari Leaflet
    const markerIconUrl = 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png';

    // Item untuk Lokasi Penting (Marker)
    labels.push(
        '<img src="' + markerIconUrl + '"> Lokasi Penting'
    );

    // Item untuk Area Persawahan (Polygon)
    labels.push(
        '<i style="background: #32a852"></i> Area Persawahan'
    );

    div.innerHTML = labels.join('<br>');
    return div;
};

legend.addTo(mymap);
